# Mesh UV Mask Generator for Unity

Unity エディタ拡張で、選択したメッシュの UV レイアウトからマスクテクスチャを生成するツールです。高度な面選択機能とリアルタイムプレビューを提供します。

## 主要機能

### 🎯 高度な面選択システム
- **Interactive Face Selector**: シーンビューで直接面をクリックして選択
- **平面選択**: クリックした面と同じ平面上の面を自動選択
- **類似UV選択**: テクスチャ色、UV密度、マテリアルなどによる智能的な一括選択
- **視覚的フィードバック**: 選択面とホバー面をリアルタイムでハイライト表示

### 🎨 柔軟なレンダリング設定
- **2つのレンダリングモード**: 塗りつぶし（デフォルト）またはワイヤーフレーム
- **8つのUVチャンネル対応**: UV0〜UV7まで全てのUVチャンネルをサポート
- **カスタマイズ可能な外観**: テクスチャサイズ、背景色、マスク色、線の太さ

### ⚡ リアルタイムプレビュー
- **自動更新**: パラメータ変更時に即座にプレビューを更新
- **エクスポート機能**: PNG形式でアセットとして保存

## インストール

1. リポジトリをクローンまたはダウンロード
2. `Editor/` フォルダを Unity プロジェクトの `Assets/Editor/` にコピー

## 使用方法

### 1. 基本的な使い方

1. **エディタウィンドウを開く**
   - メニューバーから `Window > Mesh UV Mask Generator` を選択

2. **メッシュを選択**
   - Hierarchy または Project ビューで以下のいずれかを選択：
     - MeshFilter コンポーネントを持つ GameObject
     - SkinnedMeshRenderer コンポーネントを持つ GameObject

3. **設定を調整**
   - 選択モード、UVチャンネル、テクスチャサイズなどを設定
   - プレビューがリアルタイムで更新されます

4. **保存**
   - 「Save Texture As...」ボタンでPNG形式で保存

### 2. 面選択モード詳細

#### All（全選択）
メッシュ全体のUVマスクを生成

#### SubMesh（サブメッシュ選択）
特定のサブメッシュのみを選択

#### Material（マテリアル選択）
特定のマテリアルが割り当てられた面のみを選択

#### Vertex Group（頂点グループ選択）
頂点インデックスで範囲指定（例: "0-10,15,20-25"）

#### Interactive Faces（インタラクティブ面選択）
シーンビューでの視覚的な面選択

### 3. Interactive Face Selector

#### 選択動作モード

**Single Face（単一面選択）**
- クリックした面のみを選択

**Planar Faces（平面選択）** ⭐ デフォルト
- クリックした面と同じ平面上の面を自動選択
- 角度閾値スライダー（0.1°〜45°）で判定の厳密さを調整
- 壁、床、天井などの平面を一度のクリックで選択可能

**Similar UV（類似UV選択）**
- 4つの類似性検出アルゴリズム：

1. **Texture Color（テクスチャ色類似）**
   - 面のUV座標でのテクスチャ色をサンプリング
   - RGB または HSV 色空間での比較
   - 同色のボタンやパネルなどを一括選択

2. **UV Range（UV範囲類似）**
   - UV座標の範囲と位置を比較
   - テクスチャアトラスの同じ領域を使用する面を選択

3. **UV Density（UV密度類似）**
   - テクセル密度（3D面積に対するUV面積の比率）で判定
   - 同じテクスチャスケール/解像度を持つ面を選択

4. **Material Same（マテリアル同一）**
   - 同じマテリアルを使用する全ての面を選択

#### 操作方法
- **左クリック**: 選択/選択解除
- **Shift + クリック**: 選択に追加
- **Ctrl/Cmd + クリック**: 選択から削除
- **Alt + クリック**: 選択モードを一時的に切り替え

#### 視覚機能
- **Check Occlusion**: 他のオブジェクトに隠れた面の選択を防止
- **Occlusion Layers**: 遮蔽物として扱うレイヤーを指定
- **リアルタイムプレビュー**: ホバー時に選択される面を表示

## 使用例

### テクスチャ制作
- UV レイアウトの確認用テンプレート
- Substance Painter などでのマスク素材
- UV の歪みチェック

### ゲーム開発
- **UI要素**: 同色のボタンやアイコンを一括選択
- **建築要素**: 窓、ドア、タイルなどの同一要素を効率的に選択
- **プロップ**: 繰り返し要素やパターンの選択

### シェーダー開発
- UV座標のデバッグ用テクスチャ
- UV アニメーション用のマスク生成
- マルチ UV チャンネルの可視化

## 技術仕様

### 対応Unity バージョン
Unity 2019.4 以降

### 対応メッシュ形式
- MeshFilter のメッシュ
- SkinnedMeshRenderer のメッシュ
- マルチマテリアル対応
- 8つのUVチャンネル全てに対応

### パフォーマンス
- リアルタイムプレビュー生成
- 効率的な平面検出アルゴリズム
- キャッシュシステムによる最適化
- 大規模メッシュ対応

### アルゴリズム
- **ワイヤーフレーム描画**: Bresenham のライン描画アルゴリズム
- **ポリゴン塗りつぶし**: 重心座標を用いた三角形内部判定
- **平面検出**: 法線ベースの効率的な共面判定
- **色類似度**: RGB/HSV色空間での知覚的類似度計算
- **UV密度**: テクセル密度による精密なスケール比較
- **遮蔽判定**: 物理レイキャストによる可視性チェック

## 注意事項

- UV座標が 0-1 の範囲外にある場合も正しく描画されます
- 大きなメッシュや高解像度設定では生成に時間がかかる場合があります
- メモリ使用量はテクスチャサイズに比例します（4096x4096 で約64MB）
- テクスチャ色サンプリングには読み取り可能なテクスチャが必要です

## ライセンス

MIT License

## 更新履歴

### v2.0.0 (最新)
- Interactive Face Selector の追加
- 平面選択機能（角度閾値調整可能）
- 類似UV選択（4つの検出アルゴリズム）
- 遮蔽判定機能
- リアルタイムプレビュー
- 自動プレビュー更新

### v1.0.0
- 基本的なUVマスク生成機能
- 8つのUVチャンネル対応
- ワイヤーフレーム/塗りつぶしモード
- PNG エクスポート機能